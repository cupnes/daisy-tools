# 雑多なTIPS

後々、ちゃんとしたドキュメントを書く予定ですが、ひとまずdaisy-toolsを使用する上でのあれこれを書き並べておきます。

- 現状の`dsy-sysenv`はエラー終了すると`running`ファイルが残るが、特に手動で消す必要は無い
  - [`dsy-sysenv`の起動時は、`running`ファイルが無ければ作るだけ](https://github.com/cupnes/daisy-tools/blob/c576a5e95a24af27cafe396cfb0dca04771473e4/sysenv.c#L137)
- `dsy-dump-cell`等のツールで細胞ファイルを指定する際は`cell`ディレクトリ内のファイル名で指定する
- `cell-fitness-logger`の使い方
  - `samples/run`で実行すれば、`dsy-sysenv`と共に適切に起動される
  - 単体で実行する場合は↓
    ```bash
    $ samples/cell-fitness-logger >>cell-fitness-logger.log 2>&1
    ```
- 停止方法
  - `running`ファイルを消す
- 再開方法
  - 前提: `running`ファイルを消す方法で停止していること
  - `dsy-sysenv`を実行するだけでOK(`samples/run`でも可)
- 周期処理の間にウェイト時間を設定する方法
  - `dsy-sysenv`のコマンドライン引数(第1引数)にマイクロ秒単位で指定する
  - デフォルトは1000000(1秒)
  - ウェイト時間10秒で実行する例
    ```bash
    $ bin/dsy-sysenv 10000000
    ```
- 適応度100の細胞が生まれても`dsy-sysenv`を終了させないで動作させ続ける方法(エンドレスモード)
  - `dsy-sysenv`を実行したディレクトリ(`running`ファイルが置かれるディレクトリ)に`endless`という名前のファイルを置く
  - `endless`ファイルの配置/削除は`dsy-sysenv`の実行中に行っても良い
    - `endless`ファイルの存在確認は細胞の評価結果で適応度が100になる度に行われる
- エンドレスモードの有効化を設定するファイルのファイル名を変える方法
  - デフォルトは"endless"
  - [`dsy-sysenv/sysenv.h`の定数`ENDLESS_FILENAME`](https://github.com/cupnes/daisy-tools/blob/c576a5e95a24af27cafe396cfb0dca04771473e4/sysenv.h#L15)を書き換えれば良い
- 突然変異で進化した実行バイナリを評価時に実行することについて
  - 突然変異の仕方によっては↓のようにsegvに陥ることはある
    ```
    bin/dsy-eval: 18 行: 357401 Segmentation fault      ./${TMP_NAME}.elf > ${TMP_NAME}.out 2> /dev/null
    ```
  - なお、環境に存在しないコード化合物(命令単位)へは突然変異しない仕様なので、細胞の評価時に意図しない命令が実行されることは無い
  - また、`syscall`命令は、事前の`RAX`へのシステムコール番号設定とセットで一つのコード化合物にしておくことで、実行されるシステムコールも制限できる
    - 少なくとも、`samples`ディレクトリ内の各サンプルで生成されるコード化合物はそのようになっている
  - そのため、`dsy-eval`に使うシェルスクリプトやプログラムは、それ自身が何かを標準出力や標準エラー出力へ出力しないようにファイルや`/dev/null`等へリダイレクトしておいたほうが良い
    - `dsy-eval`が何かを出すと、それがそのまま`dsy-sysenv`や`sample/run`実行時に周期的に画面に出る(`dsy-eval`が周期的に実行されるので)
    - 特に細胞のELF実行時の標準エラー出力はリダイレクトしておく方が良い(segvとか画面に出ることになるのでギョッとする)
- 突然変異の仕様
  - 突然変異は命令単位
  - 突然変異の種別
    - `INSERT_PREV`
    - `INSERT_NEXT`
    - `MODIFY`
    - `REMOVE`
- 細胞ファイル・コード化合物ファイルの動的追加方法
  - 細胞ファイル(`cell`ディレクトリ)：
    - 毎周期、`cell`ディレクトリ内の全ファイルをチェックしているので、動的にファイルを追加すれば勝手に認識される
  - コード化合物ファイル(`code`ディレクトリ)：
    - 起動時に`code`ディレクトリ内のファイルリストを作っているので、動的にファイルを追加した場合は、`dsy-sysenv`を実行したディレクトリ(`running`ファイルが存在するディレクトリ)に`update_code`という名前のファイルを置くと、次の周期の始めにコード化合物ファイルリストの更新が行われる

